<div class="messages-container" *ngIf="messages.length > 0">
  <div class="message-group" *ngFor="let group of messageGroups">
    <div class="date-divider">
      <div class="line"></div>
      <span class="date-label">{{ group.date }}</span>
      <div class="line"></div>
    </div>

    <div *ngFor="let message of group.messages" class="message" [class.guest]="isCurrentUser(message.userId)"
      (mouseover)="showReactionOptions($event, message)" (mouseleave)="hideReactionOptions($event, message)">
      <div class="avatar-container" *ngIf="message.avatar">
        <img [src]="'assets/img/avatars/' + message.avatar" [alt]="message.username + ' avatar'" class="user-avatar">
      </div>
      <div class="message-content">
        <div class="message-header">
          <span class="username">{{ message.username }}</span>
          <span class="timestamp">{{ message.timestamp | date:'HH:mm' }} Uhr</span>
        </div>
        <div class="message-text">
          {{ message.text }}

          <!-- Reaktions-Optionen -->
          <div class="reaction-options" [class.show]="message.showReactions">
            <div class="quick-reactions">
              <div class="reaction-emoji" (click)="addReaction(message, '👍')">👍</div>
              <div class="reaction-emoji" (click)="addReaction(message, '❤️')">❤️</div>
              <div class="reaction-emoji" (click)="addReaction(message, '😂')">😂</div>
              <div class="reaction-emoji picker-trigger" (click)="showEmojiPickerForMessage($event, message)">
                <mat-icon>add_reaction</mat-icon>
              </div>
            </div>
          </div>

          <!-- Emoji Picker -->
          <div class="message-emoji-picker" *ngIf="message.showEmojiPicker">
            <div class="emoji-container">
              <div class="emoji" *ngFor="let emoji of emojis" (click)="addReaction(message, emoji)">
                {{ emoji }}
              </div>
            </div>
          </div>

        </div>

        <!-- Angezeigte Reaktionen unter der Nachricht -->
        <div class="message-reactions" *ngIf="message.reactions && message.reactions.length > 0">
          <div class="reaction-badge" 
               *ngFor="let reaction of groupReactions(message.reactions)"
               (click)="$event.stopPropagation(); toggleReaction(message, reaction)"
               [class.user-reacted]="hasUserReacted(message, reaction.emoji)">
            <span class="reaction-emoji">{{ reaction.emoji }}</span>
            <span class="reaction-count">{{ reaction.count }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>